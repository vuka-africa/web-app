<!-- Basic Auth: Username/password form -->
@if (!oauthEnabled) {
  <div>
    <form class="layout-column" [formGroup]="loginForm" (ngSubmit)="login()" id="login-form">
      <mat-form-field class="login-field flex-align-center">
        <mat-label>{{ 'labels.inputs.Username' | translate }}</mat-label>
        <input
          matInput
          type="text"
          autocomplete="username"
          formControlName="username"
          [placeholder]="'labels.placeholders.Enter your username' | translate"
        />
        <mifosx-m3-icon matIconPrefix name="account_circle"></mifosx-m3-icon>
        @if (loginForm.controls.username.hasError('required')) {
          <mat-error>
            {{ 'labels.inputs.Username' | translate }}
            <strong>{{ 'labels.commons.is required' | translate }}</strong>
          </mat-error>
        }
      </mat-form-field>

      <!-- Password Field -->
      <mat-form-field class="login-field" appearance="fill">
        <mat-label>{{ 'labels.inputs.Password' | translate }}</mat-label>
        <input
          matInput
          [type]="passwordInputType"
          autocomplete="current-password"
          formControlName="password"
          [placeholder]="'labels.placeholders.Enter your password' | translate"
        />
        <mifosx-m3-icon matIconPrefix name="lock"></mifosx-m3-icon>
        @if (loginForm.controls.password.value && !loading) {
          <button
            type="button"
            matSuffix
            mat-icon-button
            (click)="togglePasswordVisibility()"
            [attr.aria-label]="passwordInputType === 'password' ? 'Show password' : 'Hide password'"
          >
            @if (passwordInputType === 'password') {
              <mifosx-m3-icon name="visibility"></mifosx-m3-icon>
            } @else {
              <mifosx-m3-icon name="visibility_off"></mifosx-m3-icon>
            }
          </button>
        }
        @if (loginForm.controls.password.hasError('required')) {
          <mat-error>
            {{ 'labels.inputs.Password' | translate }}
            <strong>{{ 'labels.commons.pass is required' | translate }}</strong>
          </mat-error>
        }
      </mat-form-field>

      <!-- Loading Progress -->
      @if (loading) {
        <mat-progress-bar mode="indeterminate" class="login-progress"></mat-progress-bar>
      }

      <!-- Submit Button -->
      <mifosx-m3-button
        variant="filled"
        type="submit"
        class="login-submit-button"
        [disabled]="!loginForm.valid || loading"
        [fullWidth]="true"
        [label]="(loading ? 'labels.buttons.Signing in...' : 'labels.buttons.Login') | translate"
      >
        @if (loading) {
          <mat-spinner [diameter]="20" class="button-spinner"></mat-spinner>
        }
      </mifosx-m3-button>

      <!-- Forgot Password Link -->
      <div class="login-actions">
        <a href="#" class="forgot-password-link">
          {{ 'labels.links.Forgot Password?' | translate }}
        </a>
      </div>
    </form>
  </div>
}

<!-- OAuth/OIDC: Simple login button (no credentials needed) -->
@if (oauthEnabled) {
  <div class="layout-column">
    <button
      mat-raised-button
      color="primary"
      class="login-button-first flex-align-center"
      (click)="loginOAuth()"
      [disabled]="loading"
    >
      {{ 'labels.buttons.Login' | translate }}
      @if (loading) {
        <mat-spinner [diameter]="20"></mat-spinner>
      }
    </button>
  </div>
}
